### Однофайловая версия (копируйте целиком в `index.html`)

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- Фиксированная ширина под iframe Yclients -->
  <meta name="viewport" content="width=374">
  <title>Wazzup для Yclients</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 374px;
      height: 100vh;
      overflow: hidden;
      background: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #222;
    }

    /* Верхняя панель */
    .topbar {
      height: 44px;
      padding: 0 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #f0f0f0;
      background: #ffffff;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: linear-gradient(135deg, #25D366, #128C7E);
    }

    .topbar-title {
      font-size: 14px;
      font-weight: 600;
      color: #222;
    }

    .topbar-logout {
      border: none;
      background: transparent;
      font-size: 12px;
      color: #999;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .topbar-logout:hover {
      background: #f5f5f5;
    }

    /* Контейнеры */
    #loader,
    #error,
    #chat-container {
      width: 100%;
      height: calc(100vh - 44px); /* минус topbar */
    }

    /* Loader */
    .loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #666;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #25D366;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    .loader p {
      font-size: 14px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error State */
    .error {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 24px;
      text-align: center;
    }

    .error h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 8px;
    }

    .error p {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }

    .error button {
      padding: 10px 20px;
      background: #25D366;
      color: #ffffff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .error button:hover {
      background: #1ebe57;
    }

    /* Chat Container */
    #chat-container {
      position: relative;
    }

    #wazzup-iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Utility */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Верхняя панель -->
  <header class="topbar">
    <div class="topbar-left">
      <span class="logo-dot"></span>
      <span class="topbar-title">Чаты Wazzup</span>
    </div>
    <button id="logout-btn" class="topbar-logout" type="button">
      Выйти
    </button>
  </header>

  <!-- Loader -->
  <div id="loader" class="loader">
    <div class="spinner"></div>
    <p>Загрузка мессенджеров...</p>
  </div>

  <!-- Error State -->
  <div id="error" class="error hidden">
    <h3>Не удалось загрузить чаты</h3>
    <p id="error-message"></p>
    <button id="retry-btn" type="button">Попробовать снова</button>
  </div>

  <!-- Main iframe container -->
  <div id="chat-container" class="hidden">
    <iframe
      id="wazzup-iframe"
      frameborder="0"
      allowfullscreen
      title="Чаты Wazzup">
    </iframe>
  </div>

  <script>
    // ======= КОНФИГ (для прототипа; в проде выносить на сервер) =======
    const CONFIG = {
      WAZZUP_API_TOKEN: '1182d7f92b7e43b8b32f74d0bd24fa80',
      YCLIENTS_API_TOKEN: '9950f34db8913770cb8696a8eac2beca',

      WAZZUP_API_BASE: 'https://api.wazzup24.com/v3',
      YCLIENTS_API_BASE: 'https://api.yclients.com/api/v1',
      WAZZUP_IFRAME_BASE: 'https://app.wazzup24.com/iframe',

      AUTH_REQUIRED: false // true — если хотите имитировать авторизацию
    };

    // ======= УТИЛИТЫ: телефон =======
    function formatPhone(phone) {
      if (!phone) return null;
      let cleaned = String(phone).replace(/\D/g, '');

      if (cleaned.startsWith('8') && cleaned.length === 11) {
        cleaned = '7' + cleaned.slice(1); // РФ 8XXXXXXXXXX -> 7XXXXXXXXXX
      }

      if (cleaned.length === 10) {
        cleaned = '7' + cleaned; // без кода страны считаем РФ
      }

      return '+' + cleaned;
    }

    function isValidPhone(phone) {
      if (!phone) return false;
      const cleaned = String(phone).replace(/\D/g, '');
      return cleaned.length >= 10 && cleaned.length <= 15;
    }

    // ======= Псевдо-авторизация (фронтовая заглушка) =======
    function isAuthorized() {
      if (!CONFIG.AUTH_REQUIRED) return true;
      return !!localStorage.getItem('wazzup_yclients_auth');
    }

    function setAuthorized() {
      localStorage.setItem('wazzup_yclients_auth', '1');
    }

    function logout() {
      localStorage.removeItem('wazzup_yclients_auth');
      try {
        window.parent.postMessage({ type: 'logout' }, '*');
      } catch (e) {
        console.warn('[logout] postMessage не удался:', e);
      }
      location.reload();
    }

    function showAuthError() {
      const loader = document.getElementById('loader');
      const errorBlock = document.getElementById('error');
      const errorMsg = document.getElementById('error-message');

      if (loader) loader.classList.add('hidden');
      if (errorBlock) errorBlock.classList.remove('hidden');
      if (errorMsg) {
        errorMsg.textContent = 'Требуется авторизация для работы с мессенджерами.';
      }
    }

    // ======= Работы с Wazzup API =======
    async function syncContactToWazzup(contactData) {
      const url = CONFIG.WAZZUP_API_BASE + '/contacts';

      const response = await fetch(url, {
        method: 'PATCH',
        headers: {
          'Authorization': 'Bearer ' + CONFIG.WAZZUP_API_TOKEN,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(contactData)
      });

      if (!response.ok) {
        console.error('[syncContactToWazzup] Ошибка:', response.status, response.statusText);
        throw new Error('Wazzup API error: ' + response.status);
      }

      return response.json();
    }

    async function getWazzupChannels() {
      const url = CONFIG.WAZZUP_API_BASE + '/channels';

      const response = await fetch(url, {
        headers: {
          'Authorization': 'Bearer ' + CONFIG.WAZZUP_API_TOKEN
        }
      });

      if (!response.ok) {
        console.error('[getWazzupChannels] Ошибка:', response.status, response.statusText);
        throw new Error('Не удалось получить список каналов: ' + response.status);
      }

      return response.json();
    }

    const CRITICAL_STATES = [
      'qridle',
      'phoneUnavailable',
      'disabled',
      'blocked'
    ];

    // ======= Загрузка iframe Wazzup =======
    function buildWazzupIframeUrl(phone) {
      const params = new URLSearchParams({
        scope: 'card',
        phone: phone
      });
      return CONFIG.WAZZUP_IFRAME_BASE + '?' + params.toString();
    }

    function loadWazzupChat(phone) {
      const iframe = document.getElementById('wazzup-iframe');
      if (!iframe) {
        console.error('[loadWazzupChat] Iframe не найден');
        return;
      }

      const url = buildWazzupIframeUrl(phone);
      console.log('[loadWazzupChat] Загружаем iframe:', url);

      iframe.src = url;

      iframe.onload = function () {
        console.log('[loadWazzupChat] Iframe загружен');
        const loader = document.getElementById('loader');
        const errorBlock = document.getElementById('error');
        const chatContainer = document.getElementById('chat-container');

        if (loader) loader.classList.add('hidden');
        if (errorBlock) errorBlock.classList.add('hidden');
        if (chatContainer) chatContainer.classList.remove('hidden');

        try {
          window.parent.postMessage({ type: 'ready' }, '*');
        } catch (e) {
          console.warn('[loadWazzupChat] postMessage ready не удался:', e);
        }
      };

      iframe.onerror = function () {
        console.error('[loadWazzupChat] Ошибка загрузки iframe');
        showError('Не удалось загрузить интерфейс Wazzup');
      };
    }

    // ======= Общая логика =======
    const urlParams = new URLSearchParams(window.location.search);
    const salonId   = urlParams.get('salon_id');
    const clientId  = urlParams.get('client_id');
    const clientPhone = urlParams.get('client_phone');
    const clientName  = urlParams.get('client_name') || '';
    const staffId   = urlParams.get('staff_id') || '';
    const recordId  = urlParams.get('record_id') || '';

    function showError(message) {
      const loader = document.getElementById('loader');
      const errorBlock = document.getElementById('error');
      const errorMsg = document.getElementById('error-message');
      const chatContainer = document.getElementById('chat-container');

      if (loader) loader.classList.add('hidden');
      if (chatContainer) chatContainer.classList.add('hidden');
      if (errorBlock) errorBlock.classList.remove('hidden');
      if (errorMsg) errorMsg.textContent = message || 'Произошла неизвестная ошибка.';
    }

    function validateRequiredParams() {
      if (!salonId || !clientId || !clientPhone) {
        console.error('[validateRequiredParams] Отсутствуют обязательные параметры', {
          salonId: salonId,
          clientId: clientId,
          clientPhone: clientPhone
        });
        showError('Недостаточно данных для загрузки чата. Обратитесь к администратору.');
        throw new Error('Missing required parameters');
      }
    }

    function checkAuthOrFail() {
      if (!isAuthorized()) {
        console.warn('[checkAuthOrFail] Пользователь не авторизован');
        showAuthError();
        throw new Error('Not authorized');
      }
    }

    async function init() {
      console.log('[init] Старт инициализации интеграции Wazzup/Yclients');

      document.getElementById('logout-btn')?.addEventListener('click', logout);
      document.getElementById('retry-btn')?.addEventListener('click', function () {
        location.reload();
      });

      try {
        validateRequiredParams();
        checkAuthOrFail();

        const formattedPhone = formatPhone(clientPhone);
        console.log('[init] Исходный телефон:', clientPhone, '=>', formattedPhone);

        if (!formattedPhone || !isValidPhone(formattedPhone)) {
          showError('Номер телефона клиента указан некорректно.');
          throw new Error('Invalid phone number');
        }

        const contactPayload = {
          phone: formattedPhone,
          name: clientName,
          crmLink: 'https://yclients.com/clients/' + clientId,
          crmLinkTitle: 'Открыть в Yclients',
          customFields: {
            salon_id: salonId,
            staff_id: staffId,
            record_id: recordId
          }
        };

        console.log('[init] Синхронизация контакта в Wazzup:', contactPayload);
        await syncContactToWazzup(contactPayload);

        const channelsResponse = await getWazzupChannels();
        const channels = Array.isArray(channelsResponse)
          ? channelsResponse
          : (channelsResponse.data || channelsResponse.channels || []);

        console.log('[init] Получены каналы Wazzup:', channels);

        const activeChannels = channels.filter(function (ch) { return ch.state === 'active'; });
        const hasCritical = channels.some(function (ch) { return CRITICAL_STATES.includes(ch.state); });

        if (hasCritical) {
          console.warn('[init] Есть каналы в критическом состоянии');
        }

        if (activeChannels.length === 0) {
          showError('Нет активных каналов в Wazzup. Подключите мессенджеры в настройках Wazzup.');
          return;
        }

        loadWazzupChat(formattedPhone);
      } catch (error) {
        console.error('[init] Ошибка инициализации:', error);
        if (!(error instanceof Error && error.message === 'Not authorized')) {
          showError('Ошибка инициализации: ' + (error.message || error));
        }
      }
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
```
